---
import { navItems } from 'src/constants';
import NavItem2 from './NavItem2.astro';
---

<script>
  function toggleTheme(theme: 'light' | 'dark') {
    const themeIconPath = document.querySelector('#theme-icon-path');

    if (theme === 'light') {
      localStorage.setItem('theme', 'light');
      document.documentElement.classList.remove('dark');
      themeIconPath?.setAttribute(
        'd',
        'M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z',
      );
    } else {
      localStorage.setItem('theme', 'dark');
      document.documentElement.classList.add('dark');
      themeIconPath?.setAttribute(
        'd',
        'M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z',
      );
    }
  }

  const toggleMenuBtn = document.querySelector('#mobile-menu-button');
  const mobileMenuIcon = document.querySelector('#menu-svg-path');
  toggleMenuBtn?.addEventListener('click', () => {
    const mobileMenu = document.querySelector('.mobile-menu');
    if (mobileMenu?.classList.contains('hide')) {
      mobileMenu.classList.remove('hide');
      mobileMenuIcon?.setAttribute('d', 'M6 18L18 6M6 6l12 12');
    } else {
      mobileMenu?.classList.add('hide');
      mobileMenuIcon?.setAttribute(
        'd',
        'M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5',
      );
    }
  });

  const themeToggle = document.querySelector('#theme-toggle');
  themeToggle?.addEventListener('click', () => {
    const currentTheme = localStorage.theme;
    toggleTheme(currentTheme === 'dark' ? 'light' : 'dark');
  });
</script>

<nav class='sticky-nav'>
  <div
    class='flex items-center justify-between w-full p-8 bg-white shadow-md transition-colors transform ease-linear dark:bg-gray-900'
  >
    <div class='flex space-x-2'>
      <NavItem2 href='/'>
        <span class='text-xl font-bold md:text-3xl'> David Neuman</span>
      </NavItem2>
    </div>
    <div class='flex space-x-4'>
      <div class='hidden space-x-4 items-center md:flex'>
        {
          navItems.map(({ name, href, popOut }) => (
            <NavItem2 href={href} popOut={popOut}>
              {name}
            </NavItem2>
          ))
        }
      </div>
      <button
        id='mobile-menu-button'
        class='py-2 px-2 rounded transition-colors ease-in-out md:hidden'
      >
        <svg
          xmlns='http://www.w3.org/2000/svg'
          fill='none'
          viewBox='0 0 24 24'
          stroke-width='1.5'
          stroke='currentColor'
          class='w-6 h-6'
        >
          <path
            id='menu-svg-path'
            stroke-linecap='round'
            stroke-linejoin='round'
            d='M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5'></path>
        </svg>
      </button>
      <button
        class='py-2 px-2 rounded transition-colors ease-in-out bg-gray-100 hover:bg-gray-200 dark:bg-cool-gray-900 dark:hover:bg-cool-gray-800'
        aria-label='Toggle Dark Mode'
        id='theme-toggle'
      >
        <svg
          xmlns='http://www.w3.org/2000/svg'
          fill='none'
          viewBox='0 0 24 24'
          stroke-width='1.5'
          stroke='currentColor'
          class='w-6 h-6'
        >
          <path
            id='theme-icon-path'
            stroke-linecap='round'
            stroke-linejoin='round'
            d='M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z'
          ></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile menu -->
  <div
    class='mobile-menu hide absolute w-full flex flex-col justify-center items-center px-2 pt-2 pb-3 space-x-4 space-y-4 bg-white shadow-md dark:bg-gray-900 md:hidden'
  >
    {
      navItems.map(({ name, href, popOut }) => (
        <NavItem2 href={href} popOut={popOut}>
          {name}
        </NavItem2>
      ))
    }
  </div>
</nav>

<style>
  .mobile-menu {
    transition: opacity ease-in 100ms, visibility ease-in 100ms;
    opacity: 1;
  }

  .mobile-menu.hide {
    visibility: hidden;
    opacity: 0;
  }
</style>
